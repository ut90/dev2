# 図書館管理システム システム設計書

## 0. STEP1実装範囲

STEP1では、以下の優先順位で実装を進める：

1. **UI設計**
   - 画面遷移図の作成
   - 主要画面のモックアップ作成（スタッフ用、利用者用）

2. **データモデル設計**
   - エンティティ関連図の作成
   - データベーススキーマの定義

3. **基本機能実装**
   - 蔵書管理（登録、検索）
   - 利用者管理（登録、検索）
   - 貸出・返却処理

## 1. アーキテクチャ設計

### 1.1 システム全体アーキテクチャ
本システムは、単一プロセスによる実装とし、シンプルな3層アーキテクチャを採用する。
- プレゼンテーション層：Webブラウザ
- アプリケーション層：ビジネスロジック
- データ層：リレーショナルデータベース

### 1.2 コンポーネント構成
- プレゼンテーション層：スタッフ用Web、利用者用Web
- アプリケーション層：蔵書管理、利用者管理、貸出・返却、検索機能、予約管理
- データ層：RDB (PostgreSQL)

### 1.3 技術スタック選定
- フロントエンド：HTML/CSS/JavaScript、Bootstrap
- バックエンド：Node.js + Express
- データベース：PostgreSQL

## 2. データモデル設計

### 2.1 エンティティ関連図
主要エンティティ：蔵書、書誌情報、著者、分類、利用者、スタッフ、貸出、予約、通知、設定

### 2.2 データベーススキーマ
- 蔵書関連：books、bibliographic_info、authors、book_authors、categories、book_categories
- 利用者関連：users、staff
- 貸出・予約関連：lendings、reservations、lending_history
- 通知関連：notifications
- システム設定：settings

### 2.3 データの関連性と制約
- 書籍と書誌情報：1対多
- 書誌情報と著者：多対多
- 書籍と貸出：1対多
- 利用者と貸出：1対多
- 利用者と予約：1対多

## 3. インターフェース設計

### 3.1 ユーザーインターフェース概要
- スタッフ用：ダッシュボード、蔵書管理、利用者管理、貸出・返却、予約管理、統計・レポート、設定
- 利用者用：ホーム、蔵書検索、貸出状況、予約管理、プロフィール、お知らせ

### 3.2 画面遷移図
スタッフ用・利用者用の主要画面遷移を定義

### 3.3 主要画面のモックアップ
スタッフ用ダッシュボード、利用者用蔵書検索画面など

## 4. セキュリティ設計

### 4.1 認証・認可の仕組み
- 認証方式：ユーザー名/パスワード、JWT、多要素認証
- 認可方式：役割ベースのアクセス制御（RBAC）

### 4.2 データ保護メカニズム
- 保存データの保護：AES-256暗号化、bcryptハッシュ
- 通信データの保護：HTTPS、TLS 1.3
- データアクセス制御：最小権限の原則、アクセスログ

### 4.3 セキュリティ対策
- アプリケーションセキュリティ：入力検証、SQLインジェクション対策、XSS対策
- インフラストラクチャセキュリティ：WAF、ネットワークセグメンテーション
- 運用セキュリティ：定期的な脆弱性診断、セキュリティ監査

## 5. 統合設計

### 5.1 外部システム連携
- 国立国会図書館API連携
- 書籍情報データベース連携
- 決済システム連携（延滞料金支払い）

### 5.2 API設計
- RESTful API設計原則
- エンドポイント設計
- 認証・認可方式
- レスポンス形式

### 5.3 データ連携方法
- バッチ処理による定期連携
- リアルタイム連携
- エラー処理・リトライ機構

## 6. STEP1実装計画

### 6.1 UI設計詳細
- 画面レイアウト設計
- 画面遷移設計
- 入力フォーム設計
- エラーメッセージ設計

### 6.2 データベース設計詳細
- テーブル定義
- リレーション定義
- インデックス設計
- 初期データ設計

### 6.3 実装スケジュール
- UI設計：2週間
- データモデル設計：2週間
- 基本機能実装：4週間
- テスト：2週間
